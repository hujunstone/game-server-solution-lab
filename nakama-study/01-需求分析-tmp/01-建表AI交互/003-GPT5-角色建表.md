下面给出一套围绕“角色与职业系统”的核心建表 SQL，适用于 CockroachDB，语法以 PostgreSQL 方言为准，并为关键字段补充了中文注释。可在 Go + Nakama 中直接使用（如在 migration 中执行）。

> 命名约定：
> - 表名小写复数，下划线分割，如 `characters`
> - 主键统一 `id`，类型 `UUID`，默认 `gen_random_uuid()`
> - 使用 `COMMENT ON` 写入字段注释，方便后续运维与文档生成

---

## 1. 公共与枚举类表

### 1.1 势力表（晋商等）

```sql
-- 势力表：如“晋商”等各大势力
CREATE TABLE IF NOT EXISTS factions (
    id          UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- 势力ID
    code        STRING(32) UNIQUE NOT NULL,                 -- 势力编码（如 JIN_SHANG）
    name        STRING(32) NOT NULL,                        -- 势力名称（如 晋商）
    home_city   STRING(64) NOT NULL,                        -- 出生地/大本营（如 太原府）
    icon_asset  STRING(255),                                -- 势力专属标识Icon 资源路径
    created_at  TIMESTAMPTZ NOT NULL DEFAULT now(),         -- 创建时间
    updated_at  TIMESTAMPTZ NOT NULL DEFAULT now()          -- 更新时间
);

COMMENT ON TABLE factions IS '势力表：定义如“晋商”这类势力信息';
COMMENT ON COLUMN factions.code       IS '势力编码（英文标识，用于程序内部引用）';
COMMENT ON COLUMN factions.name       IS '势力名称（如 晋商）';
COMMENT ON COLUMN factions.home_city  IS '势力默认出生地（如 太原府）';
COMMENT ON COLUMN factions.icon_asset IS '势力专属标识图标资源路径';
```

---

### 1.2 出身背景表

```sql
-- 出身背景：落榜秀才 / 镖局趟子手 / 牙行牙侩
CREATE TABLE IF NOT EXISTS backgrounds (
    id          UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- 出身ID
    code        STRING(32) UNIQUE NOT NULL,                 -- 出身编码，如 FAILED_SCHOLAR
    name        STRING(32) NOT NULL,                        -- 出身名称（落榜秀才等）
    desc        STRING(255),                                -- 描述文案
    base_str    INT NOT NULL,                               -- 初始力量
    base_agi    INT NOT NULL,                               -- 初始敏捷
    base_con    INT NOT NULL,                               -- 初始体质
    base_int    INT NOT NULL,                               -- 初始智慧
    created_at  TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at  TIMESTAMPTZ NOT NULL DEFAULT now()
);

COMMENT ON TABLE backgrounds IS '角色出身背景配置表（决定初始四维属性及初始队友）';
COMMENT ON COLUMN backgrounds.base_str IS '该出身的初始力量';
COMMENT ON COLUMN backgrounds.base_agi IS '该出身的初始敏捷';
COMMENT ON COLUMN backgrounds.base_con IS '该出身的初始体质';
COMMENT ON COLUMN backgrounds.base_int IS '该出身的初始智慧';
```

---

### 1.3 势力声望等级表

```sql
-- 势力声望等级：无名 → 知名 → 尊敬 → 崇敬 → 传奇
CREATE TABLE IF NOT EXISTS reputation_levels (
    id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    faction_id  UUID NOT NULL REFERENCES factions(id),  -- 所属势力
    level       INT  NOT NULL,                         -- 声望等级数值（1~5）
    name        STRING(32) NOT NULL,                   -- 等级名称（无名/知名/尊敬/崇敬/传奇）
    min_score   INT  NOT NULL,                         -- 达到该等级的最低声望值
    max_score   INT,                                   -- 该等级最大声望值（可留 NULL 表示无限）
    UNIQUE (faction_id, level)
);

COMMENT ON TABLE reputation_levels IS '各势力的声望等级区间定义';
COMMENT ON COLUMN reputation_levels.min_score IS '达到该声望等级需要的最低声望值';
COMMENT ON COLUMN reputation_levels.max_score IS '该声望等级的最高声望值（可为空表示无上限）';
```

---

## 2. 角色基础信息表

### 2.1 角色主表

```sql
-- 角色主表：基础信息、外观、势力、出身等
CREATE TABLE IF NOT EXISTS characters (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(), -- 角色ID
    user_id         STRING NOT NULL,                            -- 所属玩家ID（Nakama 用户ID）
    name            STRING(32) NOT NULL,                        -- 角色名称
    name_lang       STRING(8) NOT NULL DEFAULT 'zh',            -- 名字语言标识（zh/en等）
    gender          STRING(8) NOT NULL,                         -- 性别：male/female
    appearance_type STRING(16) NOT NULL,                        -- 外观预设：standard / strong
    faction_id      UUID NOT NULL REFERENCES factions(id),      -- 所属势力（Demo: 晋商）
    background_id   UUID NOT NULL REFERENCES backgrounds(id),   -- 出身背景
    level           INT  NOT NULL DEFAULT 1,                    -- 角色等级（预留）
    exp             BIGINT NOT NULL DEFAULT 0,                  -- 角色经验值（预留）
    prestige_score  INT  NOT NULL DEFAULT 0,                    -- 在所属势力中的声望数值
    created_at      TIMESTAMPTZ NOT NULL DEFAULT now(),         -- 创建时间
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT now(),         -- 更新时间
    UNIQUE (user_id, name)                                      -- 同一玩家下角色名唯一
);
COMMENT ON TABLE characters IS '玩家角色主表：基础信息、势力与出身';
COMMENT ON COLUMN characters.user_id         IS 'Nakama 用户ID';
COMMENT ON COLUMN characters.name            IS '角色名称（需前端做敏感词与长度校验）';
COMMENT ON COLUMN characters.name_lang       IS '角色名语言类型：zh=中文，en=英文';
COMMENT ON COLUMN characters.gender          IS '性别：male / female';
COMMENT ON COLUMN characters.appearance_type IS '外观预设类型：standard=标准型，strong=健壮型';
COMMENT ON COLUMN characters.faction_id      IS '所属势力ID（Demo中固定为晋商）';
COMMENT ON COLUMN characters.background_id   IS '角色出身背景ID';
COMMENT ON COLUMN characters.prestige_score  IS '在当前势力中的声望数值，用于映射声望等级';
```

> 敏感词过滤、名称长度规则应在 Go + Nakama 逻辑层完成，DB 层只保证基本唯一性。

---

## 3. 属性系统

### 3.1 角色当前属性表

```sql
-- 角色当前属性：四维、HP/DEF等
CREATE TABLE IF NOT EXISTS character_attributes (
    character_id    UUID PRIMARY KEY REFERENCES characters(id) ON DELETE CASCADE,
    -- 四维核心属性
    strength        INT NOT NULL,   -- 力量
    agility         INT NOT NULL,   -- 敏捷
    constitution    INT NOT NULL,   -- 体质
    intelligence    INT NOT NULL,   -- 智慧

    -- 派生属性（可选：也可选择在服务端每次用公式临时计算）
    max_hp          INT NOT NULL,   -- 最大生命值
    current_hp      INT NOT NULL,   -- 当前生命值
    defense         INT NOT NULL,   -- 防御力（可按实际公式调整）
    melee_attack    INT NOT NULL,   -- 近战基础伤害（未含技能加成）
    ranged_attack   INT NOT NULL,   -- 远程基础伤害（未含技能加成）

    created_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT now()
);

COMMENT ON TABLE character_attributes IS '角色属性表：四维基础与派生数值（HP/DEF等）';
COMMENT ON COLUMN character_attributes.strength     IS '力量：影响近战伤害、防御与HP';
COMMENT ON COLUMN character_attributes.agility      IS '敏捷：影响远程伤害、闪避等';
COMMENT ON COLUMN character_attributes.constitution IS '体质：主要影响生命值与防御';
COMMENT ON COLUMN character_attributes.intelligence IS '智慧：影响议价、谈判、打探等概率';
COMMENT ON COLUMN character_attributes.max_hp       IS '角色最大生命值（HP = 体质×10 + 力量×2）';
COMMENT ON COLUMN character_attributes.defense      IS '角色防御力（可按体质和力量组合计算）';
```

> HP / DEF 公式建议在服务端统一计算：
> - `HP = 体质 × 10 + 力量 × 2`
> - `DEF = 体质 × 3 + 力量 × 1`（或文档中 DEF 示例公式，按最终设计为准）

---

## 4. 技能系统

### 4.1 技能定义表

```sql
-- 技能定义：包括树状所属分类等
CREATE TABLE IF NOT EXISTS skills (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    code            STRING(64) UNIQUE NOT NULL,          -- 技能编码，如 TRADE_APPRAISE 等
    name            STRING(64) NOT NULL,                 -- 技能名称（识货、议价、重劈等）
    desc            STRING(255),                         -- 技能描述
    tree            STRING(32) NOT NULL,                 -- 所属技能树：trade(商贾之道)/defense(防卫之术)
    type            STRING(16) NOT NULL,                 -- 技能类型：active/passive
    max_level       INT NOT NULL DEFAULT 10,             -- 最大等级（识货这类无等级可设为1或0特别处理）
    is_toggle       BOOL NOT NULL DEFAULT false,         -- 是否可切换状态（预留）
    created_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT now()
);

COMMENT ON TABLE skills IS '技能配置表：定义商贾之道、防卫之术下的各类技能';
COMMENT ON COLUMN skills.tree      IS '技能所属树：trade(商贾之道)、defense(防卫之术)等';
COMMENT ON COLUMN skills.type      IS '技能类型：active=主动技能，passive=被动技能';
COMMENT ON COLUMN skills.max_level IS '技能最大等级（被动无等级可设1或特殊标记）';
```

> 具体数值公式（如议价浮动、打探成功率等）更适合写在服务器逻辑中，DB 只存元信息。

---

### 4.2 角色技能等级表

```sql
-- 角色技能：记录角色拥有哪些技能以及当前等级、经验
CREATE TABLE IF NOT EXISTS character_skills (
    character_id    UUID NOT NULL REFERENCES characters(id) ON DELETE CASCADE,
    skill_id        UUID NOT NULL REFERENCES skills(id),
    level           INT  NOT NULL DEFAULT 1,              -- 当前技能等级
    exp             INT  NOT NULL DEFAULT 0,              -- 技能经验（预留）
    last_used_at    TIMESTAMPTZ,                          -- 最近一次使用时间（用于冷却统计可以另建表）
    created_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
    PRIMARY KEY (character_id, skill_id)
);

COMMENT ON TABLE character_skills IS '角色-技能关系表：记录技能等级与经验';
COMMENT ON COLUMN character_skills.level IS '当前技能等级（1~max_level，识货可固定1级）';
```

> 技能冷却（如重劈、破甲、治疗、手术）通常按“技能使用记录 + 回合系统”在内存或单独冷却表中处理，Demo 阶段可存在内存或 Redis，不一定要落库。

---

## 5. 装备系统

### 5.1 装备位枚举表

```sql
-- 装备位类型：上衣/下装/鞋子/头饰/腰带/饰品/武器等
CREATE TABLE IF NOT EXISTS equip_slots (
    id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    code        STRING(32) UNIQUE NOT NULL, -- 槽位编码：chest/legs/boots/head/belt/accessory/weapon
    name        STRING(32) NOT NULL,        -- 槽位名称
    desc        STRING(255)
);

COMMENT ON TABLE equip_slots IS '装备槽位类型表：定义上衣、下装、鞋子、武器等部位';
```

---

### 5.2 装备品质枚举表

```sql
-- 装备品质：白绿蓝紫橙
CREATE TABLE IF NOT EXISTS item_rarities (
    id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    code        STRING(32) UNIQUE NOT NULL, -- common/uncommon/rare/epic/legendary 等
    name        STRING(32) NOT NULL,        -- 中文名称：普通/精良/优质/稀有/传说
    color       STRING(16),                 -- UI显示颜色标识
    desc        STRING(255)
);

COMMENT ON TABLE item_rarities IS '装备品质定义（白/绿/蓝/紫/橙）';
```

---

### 5.3 装备基础定义表

```sql
-- 装备基础定义：名称、部位、品质、基础属性加成
CREATE TABLE IF NOT EXISTS equipments (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    code            STRING(64) UNIQUE NOT NULL,              -- 装备编码
    name            STRING(64) NOT NULL,                     -- 装备名称（麻布短褐等）
    desc            STRING(255),                             -- 装备描述
    slot_id         UUID NOT NULL REFERENCES equip_slots(id),-- 所属装备位
    rarity_id       UUID NOT NULL REFERENCES item_rarities(id), -- 装备品质
    -- 主属性加成
    bonus_str       INT NOT NULL DEFAULT 0,                  -- 力量加成
    bonus_agi       INT NOT NULL DEFAULT 0,                  -- 敏捷加成
    bonus_con       INT NOT NULL DEFAULT 0,                  -- 体质加成
    bonus_int       INT NOT NULL DEFAULT 0,                  -- 智慧加成
    -- 武器相关（若为武器）
    base_damage     INT NOT NULL DEFAULT 0,                  -- 武器基础伤害加成
    special_effect  STRING(255),                             -- 传说装备特效描述（可为JSON）
    created_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT now()
);

COMMENT ON TABLE equipments IS '装备定义表：包含部位、品质及属性加成';
COMMENT ON COLUMN equipments.bonus_str   IS '装备提供的力量加成';
COMMENT ON COLUMN equipments.base_damage IS '武器的基础伤害加成值';
```

> 出生绑定装备（麻布短褐、棉布裈裤等）以及不同出身绑定武器（青竹手杖、熟铁短刀、黄杨算盘）可作为初始数据插入本表，并在角色创建逻辑中为角色生成对应实例。

---

### 5.4 角色已拥有装备表

```sql
-- 角色拥有的装备实例（若需要耐久、绑定等，可扩展）
CREATE TABLE IF NOT EXISTS character_equipments (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    character_id    UUID NOT NULL REFERENCES characters(id) ON DELETE CASCADE,
    equipment_id    UUID NOT NULL REFERENCES equipments(id),
    is_equipped     BOOL NOT NULL DEFAULT false,         -- 是否当前已穿戴
    -- 若需要多个同类物品，添加 stack_count 等字段
    created_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT now()
);

COMMENT ON TABLE character_equipments IS '角色拥有的装备实例表（背包+已装备）';
COMMENT ON COLUMN character_equipments.is_equipped IS '是否当前处于穿戴状态';
```

---

## 6. 团队（商队成员）系统

### 6.1 职业/角色类型表（护卫、账房等）

```sql
-- 商队职业定义：护卫/账房/郎中/向导/脚夫/货匠
CREATE TABLE IF NOT EXISTS caravan_roles (
    id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    code        STRING(32) UNIQUE NOT NULL,   -- guardian/accountant/doctor/guide/porter/storekeeper
    name        STRING(32) NOT NULL,         -- 职业名称（护卫/账房等）
    core_func   STRING(255),                 -- 核心职能描述
    base_skill  STRING(64),                  -- 基础技能名称（警戒巡逻等，或可关联skills表）
    effect_desc STRING(255)                  -- 基础技能效果描述文案
);

COMMENT ON TABLE caravan_roles IS '商队成员职业类型表（护卫、账房、郎中等）';
```

---

### 6.2 可招募 NPC 定义表

```sql
-- NPC 商队成员定义：可在酒馆/驿站被招募
CREATE TABLE IF NOT EXISTS caravan_npcs (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name            STRING(64) NOT NULL,                    -- NPC 名称（苏明远、秦铁山等）
    role_id         UUID NOT NULL REFERENCES caravan_roles(id), -- 职业类型
    base_wage_min   INT NOT NULL,                           -- 最低雇佣费用（两白银）
    base_wage_max   INT NOT NULL,                           -- 最高雇佣费用
    desc            STRING(255),                            -- NPC 简介
    created_at      TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at      TIMESTAMPTZ NOT NULL DEFAULT now()
);

COMMENT ON TABLE caravan_npcs IS '可招募为商队成员的NPC定义（酒馆/驿站遇到的人）';
COMMENT ON COLUMN caravan_npcs.base_wage_min IS 'NPC 招募价格下限（单位：两白银）';
COMMENT ON COLUMN caravan_npcs.base_wage_max IS 'NPC 招募价格上限（单位：两白银）';
```

---

### 6.3 角色已招募商队成员表

```sql
-- 角色已招募的商队成员
CREATE TABLE IF NOT EXISTS character_caravan_members (
    id              UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    character_id    UUID NOT NULL REFERENCES characters(id) ON DELETE CASCADE,
    npc_id          UUID NOT NULL REFERENCES caravan_npcs(id),
    hired_at        TIMESTAMPTZ NOT NULL DEFAULT now(),    -- 招募时间
    is_active       BOOL NOT NULL DEFAULT true,            -- 当前是否在队伍中
    UNIQUE (character_id, npc_id)
);

COMMENT ON TABLE character_caravan_members IS '角色已招募的商队成员列表';
COMMENT ON COLUMN character_caravan_members.is_active IS '是否处于已加入商队的状态（未解雇）';
```

---

## 7. 角色与出身初始成员关系（可选）

若需要将「不同出身 → 初始团队成员」完全配置化，可加一个映射表：

```sql
-- 出身背景与初始商队成员映射（如落榜秀才 → 苏明远(账房)）
CREATE TABLE IF NOT EXISTS background_initial_members (
    background_id   UUID NOT NULL REFERENCES backgrounds(id) ON DELETE CASCADE,
    npc_id          UUID NOT NULL REFERENCES caravan_npcs(id),
    PRIMARY KEY (background_id, npc_id)
);

COMMENT ON TABLE background_initial_members IS '出身背景对应的初始商队成员配置表';
```

---

## 8. 小结

以上表结构覆盖了文档中与“角色”直接相关的核心部分：

- 角色创建：`characters` + `backgrounds` + `factions`
- 身份与声望：`characters.prestige_score` + `reputation_levels`
- 属性系统：`character_attributes`
- 技能系统：`skills` + `character_skills`
- 装备系统：`equip_slots` + `item_rarities` + `equipments` + `character_equipments`
- 团队系统：`caravan_roles` + `caravan_npcs` + `character_caravan_members` (+ `background_initial_members`)

如果你需要，我可以基于这套结构再给一份：
- Demo 初始化数据插入 SQL（晋商/落榜秀才/初始装备/初始 NPC）
- 对应的 Go struct 定义（适配 Nakama 的 storage 或自建表访问）