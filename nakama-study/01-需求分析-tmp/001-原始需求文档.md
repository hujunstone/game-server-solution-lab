这是一个为您转换好的 Markdown 格式文档。为了方便阅读，我添加了自动生成的目录结构（如果您的编辑器支持 `[TOC]`），并手动整理了章节层级、表格和公式格式。

---

# 游戏设计文档：角色、战斗与跑商系统

[TOC]

## 目录
1. [角色与职业系统](#角色与职业系统)
2. [战斗系统](#战斗系统)
3. [跑商系统](#跑商系统)
4. [跑商核心操作](#跑商核心操作)

---

## 角色与职业系统

### 1. 角色创建系统

#### 1.1 基础信息设计
*   **姓名**
    *   **输入规则**：简体中文（2-6字，适配明代姓名习惯），英文字符长度（3-12位）。
    *   **校验机制**：敏感词过滤，支持重复名检测。
*   **性别与外貌**
    *   **性别影响**：主要影响角色外观、部分时装和特定称号，不影响核心权限。
    *   **外貌预设**：暂时提供2组基础脸型/体型设定供玩家选择（脸型可以一种）。
        1.  **标准型**：比例均衡，肌肉线条流畅。
        2.  **健壮型**：肩宽膀厚，胸膛宽阔，充满力量感。
*   **服饰预设**
    *   预设一套晋商风格服饰，包含以下槽位（暂时可不支持按部件调整）：
        1.  服饰
        2.  腰带
        3.  鞋子
        4.  头部装饰
        5.  饰品
        6.  武器外观

#### 1.2 背景选择
*   **势力选择**
    *   Demo中只能选择 **晋商**，出生地为 **太原府**。
*   **出身背景**

| 出身背景 | 初始属性偏向 | 初始团队成员 |
| :--- | :--- | :--- |
| **落榜秀才** | 智慧 | 掌柜 苏明远（账房） |
| **镖局趟子手** | 力量 | 老镖师 秦铁山（护卫） |
| **牙行牙侩** | 敏捷 | 码头苦力 王大力（脚夫） |

---

### 2. 角色系统

#### 2.1 身份表征系统
*   **所属势力声望等级**：衡量角色在本势力内的地位（无名 → 知名 → 尊敬 → 崇敬 → 传奇）。
*   **所属势力专属标识**：需设计晋商专属标识 Icon。

#### 2.2 属性系统

**角色核心属性**
| 核心属性 | 初始值 | 主要影响 |
| :--- | :--- | :--- |
| **力量** | 10 | 近战伤害、防御 |
| **敏捷** | 10 | 远程伤害、躲避 |
| **体质** | 10 | 生命值 |
| **智慧** | 10 | 议价成功率，谈判成功率 |

**基础数值公式**
| 属性 | 公式 |
| :--- | :--- |
| **生命值（HP）** | `HP = 体质 × 10 + 力量 × 2` |
| **防御力（DEF）** | `DEF = 体质 × 3 + 力量 × 1` |
| **近战伤害** | `基础伤害 + 力量 × 1 + 武器` |
| **远程伤害** | `基础伤害 + 敏捷 × 1` |

**不同出身的基础属性值**
| 出身背景 | 力量 | 敏捷 | 体质 | 智慧 | 总计 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **落榜秀才** | 8（-2） | 8（-2） | 9（-1） | 15（+5） | 40 |
| **镖局趟子手** | 14（+4） | 9（-1） | 13（+3） | 4（-6） | 40 |
| **牙行牙侩** | 9（-1） | 14（+4） | 8（-2） | 9（-1） | 40 |

**生命值 & 防御示例**
| 角色 | HP计算 (`体质×10 + 力量×2`) | DEF计算 (`体质 + floor(力量/2)`) |
| :--- | :--- | :--- |
| **落榜秀才** | 9×10 + 8×2 = **106** | 9 + 4 = **13** |
| **镖局趟子手** | 13×10 + 14×2 = **158** | 13 + 7 = **20** |
| **牙行牙侩** | 8×10 + 9×2 = **98** | 8 + 4 = **12** |

#### 2.3 技能系统
技能分为主动技能和被动技能，以及可升级技能，最高为10级。

**商贾之道**
```text
商贾之道
│
├─ 识货 ─ 专精
│
├─ 议价 ─ 牙行通
│
└─ 打探 ─ 行情
```
*   **识货**：被动技能（无等级），提升购买量。
    *   公式：`购买量提升 = 基础值（3%） + （智慧 ×0.2）%`
*   **议价**：主动技能，影响商品的买入价和卖出价。
    *   公式：`价格浮动 = (智慧 ×0.1% + 技能等级 ×0.5%)`
    *   *例*：智慧15，等级5级，浮动为 `(1.5% + 2.5%) = 4%`（买入-4%，卖出+4%）。
*   **打探**：被动技能，从不同NPC口中获取不同的有用信息。
    *   公式：`打探成功率 = 基础成功率15% + 智慧 ×1% + 技能等级 ×3%`

**防卫之术**
```text
防卫之术
│
├─ 攻击 ─ 重劈 ─ 破甲
│
└─ 包扎 ─ 治疗 ─ 手术
```
*   **攻击**：主动技能，普通攻击。无冷却。
    *   伤害：`基础伤害40 + 力量 ×1 + 武器伤害值`
*   **重劈**：主动技能，高伤害的单体攻击。
    *   冷却：Lv0-2: 3回合 / Lv3-6: 2回合 / Lv7-10: 1回合
    *   伤害：`(基础伤害40 + 力量 ×1) × (1.0 + 技能等级 ×0.1)`
    *   额外效果：有概率击晕敌人，`击晕概率 = 10% + 技能等级 ×2%`
*   **破甲**：对目标发动一次精准打击，旨在破坏其护甲。
    *   伤害：`破甲伤害 = (基础伤害40 + 力量 ×1) × 0.9`
    *   效果：使目标的防御力降低。`降低防御 = 8 + 技能等级 ×2`
    *   持续时间：3回合。
    *   冷却：Lv0-3: 4回合 / Lv4-7: 3回合 / Lv8-10: 2回合
*   **包扎**：主动技能，无冷却。
    *   效果：`治疗 = 15 + 技能等级 × 2`，并清除【流血】状态。
*   **治疗**：主动技能，消耗1份金疮药，冷却3回合。
    *   效果：`恢复 30 + 技能等级 × 4`。
*   **手术**：主动技能，消耗1个麻沸散，冷却5回合。
    *   效果：`恢复 50 + 技能等级 × 5`；若目标HP<30%，额外恢复缺失生命值的30%。

**技能伤害计算示例（DEF=40）**
| 技能 | 普攻基础伤 | 技能伤害 | 实际伤害 (扣除DEF) | 额外效果 |
| :--- | :--- | :--- | :--- | :--- |
| **普攻** | 40+15=55 | 55 | 15 | — |
| **重劈** | 55 | 55×(1.0+0.5)=82.5 | 42.5 | 20%概率击晕 |
| **破甲** | 55 | 55×0.9 = 49.5 | 9.5 | 降防=18点 (DEF 40→22)<br>下回合普攻伤害 = 55-22=33 (+120%提升) |

#### 2.4 装备系统

**装备类型与属性方向**
| 装备位 | 主要加成属性 |
| :--- | :--- |
| 服饰 | 体质、力量 |
| 鞋子 | 体质、敏捷 |
| 饰品 | 敏捷 |
| 头部装饰 | 智慧 |
| 腰带 | 体质 |
| 武器 | 各个属性，伤害 |

**装备品质与数值标准**
*   普通（白）：+1~2 主属性
*   精良（绿）：+2~3 主属性
*   优质（蓝）：+3~4 主属性
*   稀有（紫）：+4~6 主属性
*   传说（橙）：+6~8 主属性 + 特效

**Demo出生绑定装备（白色品质）**
| 装备位 | 名称 | 类型 | 加成属性 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| 上衣 | 麻布短褐 | 布衣 | +1 体质 | 粗麻织就，洗得发白 |
| 下装 | 棉布裈裤 | 布裤 | +1 敏捷 | 宽松合身，便于行路 |
| 鞋子 | 编草鞋 | 鞋履 | +1 敏捷 | 轻便透气，适合赶路 |
| 头饰 | 青布头巾 | 头饰 | +1 智慧 | 方正青巾，书生常裹 |
| 腰带 | 棉布腰带 | 腰带 | +1 体质 | 双层棉布，可挂小囊 |
| 饰品 | 黄铜平安扣 | 饰品 | +1 智慧 | 刻“平安”二字 |

**出生绑定武器**
| 出身 | 武器名称 | 类型 | 属性加成 | 伤害加成 |
| :--- | :--- | :--- | :--- | :--- |
| 落榜秀才 | 青竹手杖 | 钝器 | +2 智慧 | +2 |
| 镖局趟子手 | 熟铁短刀 | 刀 | +2 力量 | +4 |
| 牙行学徒 | 黄杨算盘 | 奇门 | +2 智慧 | +2 |

#### 2.5 团队系统
商队角色分类：五大职业定位与核心价值，玩家每次最多带五个成员。

| 角色 | 核心职能 | 基础技能 |
| :--- | :--- | :--- |
| **护卫** | 抵御劫掠，保障商队安全 | **警戒巡逻**（被抢概率 - 5%） |
| **账房** | 议价集采，控制成本 | **精准记账**（采购成本 - 5%） |
| **郎中** | 治疗伤病，消除不良状态 | **草药救治**（解除成员伤病） |
| **向导** | 适配地形，提升效率 | **地形辨识**（迷路概率 - 5%） |
| **脚夫** | 承载货物，加大载货量 | **重物搬运**（载货量 + 5%） |
| **货匠** | 货物保管，降低途中损坏 | **货物保管**（损害事件概率 - 5%） |

**商队成员招募（Demo版）**
*   **招募点**：酒馆或驿站。
*   **流程**：
    1.  前往招募点。
    2.  NPC主动搭话介绍能力（如乡勇护卫、退役驿卒、私塾先生等）。
    3.  玩家确认“雇你了”，NPC报价（5-12两白银）。
    4.  扣除白银，NPC加入商队。

---

## 战斗系统

### 1. 团队战斗技能设计

**团队队员伤害值设计**
| 角色 | 战斗能力 | 伤害公式 | 是否可用技能 |
| :--- | :--- | :--- | :--- |
| **护卫** | 主力输出 | `40 + 力量×1 + 武器` | ✅ 可用【重劈】 |
| **账房** | 自保反击 | `20 + 力量×0.8 + 武器` | ❌ 仅普攻 |
| **郎中** | 专注治疗 | `18 + 力量×0.7 + 武器` | ✅ 可用【治疗】【包扎】【手术】 |
| **向导** | 观察预警 | `30 + 力量×0.9 + 武器` | ❌ 仅普攻 |
| **脚夫** | 负重硬扛 | `30 + 力量×0.8 + 武器` | ❌ 仅普攻 |
| **货匠** | 工具防身 | `18 + 力量×0.7 + 武器` | ❌ 仅普攻 |

**郎中自动治疗逻辑**
*   HP < 50% → 自动使用【治疗】（若冷却就绪）。
*   有人流血/中毒 → 优先使用【包扎】。
*   有人濒死（HP<20）且有外科技能 → 尝试【手术】（仅传说品阶郎中拥有此技能）。
    *   *数值说明*：治疗量受“品阶系数”和“郎中智慧”影响。

### 2. 阵型影响
| 阵型 | 效果 | 适用场景 |
| :--- | :--- | :--- |
| **鱼鳞阵**（进攻） | 全队伤害+10%，DEF−5 | 敌弱我强，速战速决 |
| **方圆阵**（防御） | 全队DEF+10 | 面对高伤马贼 |
| **雁行阵**（机动） | 敏捷+5，先手率提升 | 对付高敏敌人 |

### 3. 核心战斗流程
每回合分为 3 阶段：
1.  **速度判定（先攻顺序）**
    *   `出手速度 = 敏捷 × 0.8 + 鞋子加成 + 随机值(-2~+2)`
    *   敌我混合排序（快者先动）。
2.  **行动选择**
    *   (1) 普通攻击
    *   (2) 技能（重劈 / 破甲 / 治疗 / 包扎 / 手术）
    *   (3) 使用道具（金疮药、烟雾弹）
    *   (4) 战术指令
3.  **状态结算**
    *   流血、中毒持续伤害；破甲效果衰减；击晕单位跳过回合。

### 4. 防御与命中机制
*   **命中率**：`50% + (玩家敏捷 − 敌人敏捷) × 0.5%`
    *   范围限制：最低30%，最高80%。
*   **实际伤害**：`max(3, (40 + 力量 + 武器伤害) − 敌人DEF)`
*   **特效触发**：先判定命中，再判定特效概率（如未命中则不触发）。

### 5. 玩家可选“战术指令”
| 战术名称 | 效果 | 冷却 | 适用场景 |
| :--- | :--- | :--- | :--- |
| **集中火力** | 全队本回合攻击同一目标 | 2回合 | 快速击杀头目 |
| **掩护撤退** | 下回合逃跑成功率+30% | 3回合 | 打不过就跑 |
| **威吓震慑** | 智慧检定，可能使1名弱敌逃跑 | 3回合 | 对付流民团伙 |
| **呼叫支援** | 呼叫本势力商栈NPC支援 | 仅用一次 | 附近有商栈且无护卫时 |

### 6. NPC怪物设置

**敌人属性**
| 敌人类型 | 力量 | 体质 | 敏捷 | HP | DEF | 伤害 | 特点 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **流民** | 8 | 9 | 10 | 106 | 30 | 48 | 弱但数量多 |
| **山匪** | 12 | 11 | 10 | 134 | 35 | 54(+2) | 均衡 |
| **山匪头目** | 14 | 12 | 11 | 148 | 40 | 58(+4) | 高伤，集火主角 |
| **马贼** | 11 | 10 | 14 | 122 | 40 | 54(+3) | 高敏先手 |

**团伙配置**
*   **流民团伙**：3×流民（各自为战，优先打血少的）。
*   **山匪小队**：1×头目 + 2×山匪（头目打主角，小兵围雇员）。
*   **马贼突袭队**：2×马贼（首回合必先手，优先杀辅助）。

### 7. 多团队战役
*适用场景：扫荡山寨、争夺贸易点*
1.  **大地图阶段（即时/战棋）**：自由移动，进行战略调度（调兵、包围）。
2.  **小队战斗阶段（回合制）**：两队相遇时触发独立战斗场景，胜负决定大地图去留。
3.  **建筑攻击阶段（即时计算）**：攻击城门/大殿时自动掉血；若被敌方队伍干扰则中断，转入小队战斗。
4.  **胜负判定**：
    *   扫荡山寨：击杀BOSS。
    *   争夺贸易点：攻击方夺旗，守卫方阻止。

---

## 跑商系统

### 1. 货物系统

#### 1.1 商品系统
**商品品类表**
| 品类 | 核心内容（典型商品） |
| :--- | :--- |
| **米粮** | 稻米、小麦、粟米、大豆、高粱 |
| **杂食** | 火腿、腊肉、酱菜、糕饼、干果 |
| **布帛** | 棉布、麻布、杭绸、云锦、素绢 |
| **皮货** | 貂裘、银鼠、狐白、牛革、羊皮 |
| **铁器** | 铁锅、锄头、剪刀、倭刀（进口） |
| **木器** | 八仙桌、车轮、棺材 |
| **瓷器** | 青花瓷、白瓷、紫砂壶 |
| **漆器** | 剔红盒、螺钿屏 |
| **药材** | 人参、当归、川贝、麝香 |
| **酒** | 黄酒、汾酒、烧酒 |
| **调料** | 酱油、蔗糖 |
| **杂货** | 油纸伞、折扇、铜镜 |
| **茶** | 松萝、岩茶、普洱（专营） |
| **香料** | 胡椒、苏木、龙涎香 |
| **番货** | 自鸣钟、火铳、象牙 |
| **盐** | 两淮盐、井盐（专营） |

**货物基础价格示例**
*   **米粮**：小麦(60文/30件)，高粱(60文/30件)。
*   **铁器**：铁锅(500文/10件)，大阳钢针(700文/4件,★★★)。
*   **布帛**：潞绸(4000文/3件,★★★★)。
*   **酒类**：汾酒(1200文/8件,★★★)。

**贸易点商品配置**
*   **太原府**：小麦、高粱、汾酒、陈醋、毛毡、粗布、野核桃。
*   **大同**：胡麻、熟皮、皮靴、皮袄、皮帽。

#### 1.2 商品价格计算模型
**影响变量**
*   `BasePrice` (基准价), `Development` (城市发展度), `HomePreference` (本地偏好), `Reputation` (声望), `Rarity` (稀有度).
*   `DemandShock` / `SupplyShock` (供需波动), `GlobalFactor` (全局平衡).
*   `TaxMarkup` (税差).

**计算公式**
1.  **价格基准系数 (H_D)**:
    `H_D = (1.0 + k_p * HomePreference) / (1.0 + k_d * Development)`
2.  **本地售价 (SalePrice)**:
    `SalePrice = BasePrice * (1.0 + TaxMarkup) * H_D * GlobalFactor * DemandShock`
3.  **本地收购价 (PurchasePrice)**:
    `PurchasePrice = BasePrice * (1.0 - TaxMarkup) * H_D * GlobalFactor * SupplyShock`
4.  **玩家配额 (AvailableQuota)**:
    `Quota = (BaseQuota + k_d * Development) * (1.0 + k_r * Reputation) * Rarity * (1.0 / GlobalFactor)`

#### 1.3 刷新机制
*   基础刷新时间：每15分钟刷新一次配额（受事件影响浮动）。

### 2. 载具系统
*   **初始马队**：马5匹，总载货50。
*   **配置**：
    *   **普通木驮**：货物损坏率10%。
    *   **边地杂马**：速度20/分钟（游戏1分钟=现实1天）。
    *   **商号旗帜**：抢劫概率 -0.5%。
*   **视觉模型**：
    *   前导伙计：头顶显示玩家名、商会名。
    *   载具：马匹+驼具+苫布+商号旗帜（招子旗）。

### 3. 贸易点系统

#### 3.1 贸易点设置
*   **地图节点**：太原府 —— 石岭关 —— 雁门关 —— 大同府。
*   **特殊地点**：云中寨（山寨）、雁门关外（可建商栈）。
*   **商路风险**：
    *   太原 → 石岭关：风险 0。
    *   石岭关 → 雁门关：风险 30%（山匪/流民）。
        *   *扫荡云中寨后降为 5%*。
    *   雁门关 → 大同府：风险 50%（马贼）。
        *   *建立商栈后降为 20% 并可呼叫支援*。

#### 3.2 贸易点地图与NPC
*   **大地图切割**：
    1.  太原府区域（石岭关以南）。
    2.  关隘通道（石岭关-雁门关）。
    3.  大同府区域（雁门关以北）。
*   **太原府细节**：
    *   **晋王府**：NPC 老承奉、仪卫百户。
    *   **三司署衙**：NPC 经历王秉忠（路引）、老书办（官府任务）。
    *   **市集**：NPC 牙行人赵四（交易）、刘婆（打探）。
    *   **晋商总会**：NPC 管事乔圣才。
*   **大同府细节**：
    *   **总兵府**：NPC 旗牌官赵铁山（边贸）。
    *   **兵备道衙门**：NPC 书吏吴九思（开中法）。
    *   **作坊区**：NPC 皮匠老鄂（委托生产）。
*   **云中寨**：包含山门陷坑、聚义厅、兵器库；NPC 守门喽啰。

---

## 跑商核心操作

### 1. 通用移动与视角控制
| 操作动作 | 主要方案 | 次选方案 | 说明 |
| :--- | :--- | :--- | :--- |
| **移动** | 鼠标左键点击 | WASD / 方向键 | 默认点击移动 |
| **视角旋转** | 按住鼠标右键拖动 | Q / E 键 | 3D自由视角 |
| **视角缩放** | 鼠标滚轮 | Page Up/Down | 支持第一人称到上帝视角 |
| **重置视角** | 鼠标中键 / Home | - | 快速复位 |

### 2. 跑商模式专用操作
| 操作动作 | 主要方案 | 说明 |
| :--- | :--- | :--- |
| **设定自动寻路** | 右键点击地图目标 | 弹出菜单“设定航线” |
| **启动/停止寻路** | A键 | 自动沿路规避危险 |

**特殊交互**：玩家靠近NPC时，自动弹出操作菜单。